# Изменения в системе деплоя TaskMind

## Обзор изменений
Конфигурация Nginx была вынесена в отдельные файлы для улучшения читаемости и обслуживания.

## Новые файлы

### nginx.conf
- **Назначение**: Основная конфигурация сервера Nginx для TaskMind
- **Содержимое**: 
  - HTTPS настройки с SSL сертификатами
  - Редирект с HTTP на HTTPS
  - Настройки безопасности (security headers)
  - Проксирование запросов к FastAPI приложению
  - Rate limiting для webhook endpoint

### nginx-http.conf
- **Назначение**: Rate limiting правила для вставки в основной nginx.conf
- **Содержимое**: Зоны ограничения скорости для webhook endpoint

## Изменения в deploy.sh

### Удалено
- Inline конфигурация Nginx (более 30 строк встроенного config)
- Команды `cat > /etc/nginx/sites-available/taskmind << 'EOF'`
- Встроенные rate limiting правила

### Добавлено
- Команда `scp nginx.conf $DEPLOY_SERVER:/etc/nginx/sites-available/taskmind`
- Команда `scp nginx-http.conf $DEPLOY_SERVER:/tmp/nginx-http-snippet.conf`
- Умная вставка rate limiting правил в основной nginx.conf

## Преимущества новой структуры

1. **Читаемость**: Конфигурация Nginx теперь в отдельных файлах
2. **Обслуживание**: Легче редактировать и тестировать конфигурацию
3. **Версионирование**: Nginx конфигурация теперь под контролем версий
4. **Переиспользование**: Конфигурацию можно использовать независимо
5. **Отладка**: Проще найти и исправить проблемы в конфигурации

## Проверка изменений

Файлы для проверки:
- ✅ `deploy/nginx.conf` - полная конфигурация HTTPS сервера
- ✅ `deploy/nginx-http.conf` - rate limiting правила  
- ✅ `deploy/deploy.sh` - обновленный скрипт деплоя
- ✅ `deploy/deploy-old.sh` - резервная копия старого скрипта

## Совместимость
- Полная обратная совместимость с существующим деплоем
- Автоматическая установка SSL сертификатов
- Автоматическая настройка rate limiting

## Следующие шаги
1. Протестировать новый скрипт деплоя на тестовом сервере
2. Выполнить деплой на продакшн с использованием нового скрипта
3. Проверить работу HTTPS и rate limiting