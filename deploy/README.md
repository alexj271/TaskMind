# üöÄ TaskMind Production Deployment

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è TaskMind –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ **visitbot.ru**.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –°–µ—Ä–≤–µ—Ä: Ubuntu/Debian Linux
- SSH –¥–æ—Å—Ç—É–ø: `ssh root@visitbot.ru` (–±–µ–∑ –ø–∞—Ä–æ–ª—è)
- –î–æ–º–µ–Ω: visitbot.ru –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞

## üõ† –§–∞–π–ª—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `deploy.sh` | –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è |
| `rollback.sh` | –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ |
| `monitor.sh` | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–≤—Ç–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ |
| `logs.sh` | –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| `.env` | Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```bash
cd deploy/
chmod +x *.sh
./deploy.sh
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
./logs.sh all
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –†–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
./monitor.sh

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–¥–æ–±–∞–≤–∏—Ç—å –≤ crontab)
*/5 * * * * /path/to/TaskMind/deploy/monitor.sh
```

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```
visitbot.ru:443 (HTTPS) ‚Üí Nginx (SSL) ‚Üí FastAPI:8000
visitbot.ru:80 (HTTP)   ‚Üí Redirect to HTTPS
                                ‚Üì
                          Dramatiq Workers
                                ‚Üì
                          Redis + PostgreSQL
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **Nginx**: Reverse proxy, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- **FastAPI**: –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ä—Ç—É 8000
- **Dramatiq**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
- **PostgreSQL**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Redis**: –û—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è Dramatiq
- **Supervisor**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
ssh root@visitbot.ru 'supervisorctl status'
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
ssh root@visitbot.ru 'supervisorctl restart taskmind-api taskmind-worker'
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
./logs.sh api      # –õ–æ–≥–∏ API
./logs.sh worker   # –õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
./logs.sh errors   # –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
./logs.sh tail     # –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

### –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
```bash
./rollback.sh
```

## üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ URL

- **–ì–ª–∞–≤–Ω–∞—è**: https://visitbot.ru
- **API Docs**: https://visitbot.ru/docs  
- **Telegram Webhook**: https://visitbot.ru/webhook/telegram
- **Health Check**: https://visitbot.ru/health

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–∫—Ä–∏–ø—Ç `monitor.sh` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ visitbot.ru –¥–æ–±–∞–≤–∏—Ç—å –≤ crontab:
*/5 * * * * /opt/TaskMind/deploy/monitor.sh

# –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤:
0 2 * * * find /var/log -name "taskmind-*.log" -mtime +7 -delete
```

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ä—ã:
- ‚úÖ SSL/HTTPS —Å Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ HTTP ‚Üí HTTPS
- ‚úÖ Security headers (HSTS, X-Frame-Options, etc.)
- ‚úÖ Rate limiting –¥–ª—è webhook —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- ‚úÖ Nginx –∫–∞–∫ reverse proxy
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —á–µ—Ä–µ–∑ Supervisor
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∞–π—Ä–≤–æ–ª (ufw)
- [ ] –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –ë–î
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

## üìù –õ–æ–≥–∏

–í—Å–µ –ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/var/log/`:
- `taskmind-api.out.log` - –í—ã–≤–æ–¥ FastAPI
- `taskmind-api.err.log` - –û—à–∏–±–∫–∏ FastAPI  
- `taskmind-worker.out.log` - –í—ã–≤–æ–¥ Dramatiq
- `taskmind-worker.err.log` - –û—à–∏–±–∫–∏ Dramatiq
- `taskmind-monitor.log` - –õ–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```bash
./logs.sh errors
ssh root@visitbot.ru 'supervisorctl restart taskmind-api'
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í–æ—Ä–∫–µ—Ä—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
```bash
ssh root@visitbot.ru 'redis-cli ping'  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis
ssh root@visitbot.ru 'supervisorctl restart taskmind-worker'
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
```bash
ssh root@visitbot.ru 'systemctl status postgresql'
ssh root@visitbot.ru 'sudo -u postgres psql -l'
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `./logs.sh errors`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤: `ssh root@visitbot.ru 'supervisorctl status'`
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ—Ç–∫–∞—Ç: `./rollback.sh`

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ
